<form [formGroup]="invoiceForm" (ngSubmit)="onSave()">
  <mat-grid-list cols="2" rowHeight="4:1" gutterSize="8px">
    <mat-grid-tile colspan="2">
      <mat-form-field>
        <mat-label>Patient Username</mat-label>
        <mat-select formControlName="patientUsername">
          <mat-option *ngFor="let patient of patients" [value]="patient.username">
            {{ patient.username }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </mat-grid-tile>

    <mat-grid-tile colspan="2">
      <mat-form-field>
        <mat-label>Doctor Username</mat-label>
        <mat-select formControlName="doctorUsername">
          <mat-option *ngFor="let doctor of doctors" [value]="doctor.username">
            {{ doctor.username }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-form-field>
        <mat-label>Date</mat-label>
        <input matInput [matDatepicker]="picker" formControlName="date" placeholder="Choose a date">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-form-field>
        <mat-label>Payment Method</mat-label>
        <input matInput formControlName="paymentMethod">
      </mat-form-field>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-form-field>
        <mat-label>Payment Date</mat-label>
        <input matInput [matDatepicker]="paymentDatePicker" formControlName="paymentDate" placeholder="Choose a date">
        <mat-datepicker-toggle matSuffix [for]="paymentDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #paymentDatePicker></mat-datepicker>
      </mat-form-field>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-form-field>
        <mat-label>Amount Paid</mat-label>
        <input matInput type="number" formControlName="amountPaid">
      </mat-form-field>
    </mat-grid-tile>

    <!-- Services -->
    <mat-grid-tile colspan="2">
      <div formArrayName="services">
        <div *ngFor="let service of services.controls; let i = index" [formGroupName]="i">
          <mat-grid-list cols="4" rowHeight="4:1" gutterSize="8px">
            <mat-grid-tile>
              <mat-form-field>
                <mat-label>Description</mat-label>
                <input matInput formControlName="description">
              </mat-form-field>
            </mat-grid-tile>

            <mat-grid-tile>
              <mat-form-field>
                <mat-label>Code</mat-label>
                <input matInput formControlName="code">
              </mat-form-field>
            </mat-grid-tile>

            <mat-grid-tile>
              <mat-form-field>
                <mat-label>Quantity</mat-label>
                <input matInput type="number" formControlName="quantity">
              </mat-form-field>
            </mat-grid-tile>

            <mat-grid-tile>
              <mat-form-field>
                <mat-label>Unit Price</mat-label>
                <input matInput type="number" formControlName="unitPrice">
              </mat-form-field>
            </mat-grid-tile>

            <mat-grid-tile colspan="2">
              <mat-form-field>
                <mat-label>Total</mat-label>
                <input matInput type="number" formControlName="total">
              </mat-form-field>
            </mat-grid-tile>

            <mat-grid-tile>
              <button mat-button (click)="removeService(i)">Remove Service</button>
            </mat-grid-tile>
          </mat-grid-list>
        </div>
        <button mat-button (click)="addService()">Add Service</button>
      </div>
    </mat-grid-tile>

    <!-- Charges -->
    <mat-grid-tile colspan="2">
      <div formArrayName="charges">
        <div *ngFor="let charge of charges.controls; let i = index" [formGroupName]="i">
          <mat-grid-list cols="4" rowHeight="4:1" gutterSize="8px">
            <mat-grid-tile>
              <mat-form-field>
                <mat-label>Description</mat-label>
                <input matInput formControlName="description">
            </mat-form-field>
          </mat-grid-tile>

            <mat-grid-tile>
              <mat-form-field>
                <mat-label>Code</mat-label>
                <input matInput formControlName="code">

            </mat-form-field>
            </mat-grid-tile>

            <mat-grid-tile>
              <mat-form-field>
                <mat-label>Quantity</mat-label>
                <input matInput type="number" formControlName="quantity">

            </mat-form-field>
            </mat-grid-tile>

            <mat-grid-tile>
              <mat-form-field>
                <mat-label>Unit Price</mat-label>
                <input matInput type="number" formControlName="unitPrice">

            </mat-form-field>
          </mat-grid-tile>

            <mat-grid-tile colspan="2">
              <mat-form-field>
                <mat-label>Total</mat-label>
                <input matInput type="number" formControlName="total">

            </mat-form-field>
          </mat-grid-tile>

            <mat-grid-tile>
              <button mat-button (click)="removeCharge(i)">Remove Charge</button>
            </mat-grid-tile>
          </mat-grid-list>
        </div>
        <button mat-button (click)="addCharge()">Add Charge</button>
      </div>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-form-field>
        <mat-label>Subtotal</mat-label>
        <input matInput type="number" formControlName="subtotal">
      </mat-form-field>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-form-field>
        <mat-label>Tax</mat-label>
        <input matInput type="number" formControlName="tax">
      </mat-form-field>
    </mat-grid-tile>

    <mat-grid-tile>
      <mat-form-field>
        <mat-label>Total</mat-label>
        <input matInput type="number" formControlName="total">
      </mat-form-field>
    </mat-grid-tile>

    <mat-grid-tile colspan="2">
      <button mat-button type="submit">Update</button>
      <button mat-button type="button" (click)="onCancel()">Cancel</button>
    </mat-grid-tile>
  </mat-grid-list>
</form>
